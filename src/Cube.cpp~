#include "Cube.h"

#include "ShaderFile.h"


#include <iostream>


Cube::Cube(std::unique_ptr<RenderComponent> renderComponent, std::unique_ptr<TextureComponent> textureComponent,
       std::unique_ptr<ShaderComponent> shaderComponent, std::unique_ptr<BufferComponent> bufferComponent) 
        : renderComponent(std::move(renderComponent)), textureComponent(std::move(textureComponent)),
          shaderComponent(std::move(shaderComponent)), bufferComponent(std::move(bufferComponent))
{
	// Przesuniêcie, ¿eby zapobiec nak³adaniu siê tekstur z kolorem obiektu.
	float offset = 0.0001f;

	vertices = {
		// Pozycje          // Tekstury
	// Przednia œciana
	-0.5f, -0.5f,  0.5f + offset,  1.0f, 1.0f,  // Lewy dolny
	 0.5f, -0.5f,  0.5f + offset,  0.0f, 1.0f,  // Prawy dolny
	 0.5f,  0.5f,  0.5f + offset,  0.0f, 0.0f,  // Prawy górny
	-0.5f,  0.5f,  0.5f + offset,  1.0f, 0.0f,  // Lewy górny

	// Tylna œciana
	-0.5f, -0.5f, -0.5f - offset,  1.0f, 1.0f,
	 0.5f, -0.5f, -0.5f - offset,  0.0f, 1.0f,
	 0.5f,  0.5f, -0.5f - offset,  0.0f, 0.0f,
	-0.5f,  0.5f, -0.5f - offset,  1.0f, 0.0f,

	// Lewa œciana
	-0.5f - offset,  0.5f,  0.5f,  0.0f, 0.0f,
	-0.5f - offset,  0.5f, -0.5f,  1.0f, 0.0f,
	-0.5f - offset, -0.5f, -0.5f,  1.0f, 1.0f,
	-0.5f - offset, -0.5f,  0.5f,  0.0f, 1.0f,

	// Prawa œciana
	 0.5f + offset,  0.5f,  0.5f,  0.0f, 0.0f,
	 0.5f + offset,  0.5f, -0.5f,  1.0f, 0.0f,
	 0.5f + offset, -0.5f, -0.5f,  1.0f, 1.0f,
	 0.5f + offset, -0.5f,  0.5f,  0.0f, 1.0f,

	 // Dolna œciana
	 -0.5f, -0.5f - offset, -0.5f,  0.0f, 1.0f,
	  0.5f, -0.5f - offset, -0.5f,  1.0f, 1.0f,
	  0.5f, -0.5f - offset,  0.5f,  1.0f, 0.0f,
	 -0.5f, -0.5f - offset,  0.5f,  0.0f, 0.0f,

	 // Górna œciana
	 -0.5f,  0.5f + offset, -0.5f,  0.0f, 1.0f,
	  0.5f,  0.5f + offset, -0.5f,  1.0f, 1.0f,
	  0.5f,  0.5f + offset,  0.5f,  1.0f, 0.0f,
	 -0.5f,  0.5f + offset,  0.5f,  0.0f, 0.0f,

	};

	indices = {
		// Przednia œciana
		0, 1, 2,
		2, 3, 0,

		// Tylnia œciana
		4, 5, 6,
		6, 7, 4,

		// Lewa œciana
		8, 9, 10,
		10, 11, 8,

		// Prawa œciana
		12, 13, 14,
		14, 15, 12,

		// Dolna œciana
		16, 17, 18,
		18, 19, 16,

		// Górna œciana
		20, 21, 22,
		22, 23, 20
	};

}

void Cube::init()
{ 
	  // shader component
	shaderComponent->compileShaderFromFile("vertexFilePath", "fragmentFilePath");

	  // buffer component
	  bufferComponent->bindBuffers(vertices, indices);
	  bufferComponent->setAttribPointer();
	  bufferComponent->unbindBuffers();

	  textureComponent->applyTexture();

	  // mvp translate, rotate, perspective
	  mvp.setMvpMatrix();
}

void Cube::render()
{
	  // shader component
	  shaderComponent->useShaderProgram();

	  mvp.sendToShader(shaderComponent->getProgramID(), "mvp");
	  
	  // Render component
	  bufferComponent->bindVAO();
	  renderComponent->render(indices);
	  bufferComponent->unbindVAO();
	 
	  textureComponent->sendToShader(shaderComponent->getProgramID());
}

MvpComponent& Cube::getMVP()
{
	  return mvp;
}
